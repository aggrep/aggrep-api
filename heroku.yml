setup:
  addons:
    - plan: heroku-postgresql
    - plan: heroku-redis

build:
  docker:
    web: Dockerfile
  config:
    FLASK_APP: autoapp.py
    FLASK_ENV: production

release:
  image: web
  command:
    - flask db upgrade

run:
  web: gunicorn autoapp:app -b 0.0.0.0:$PORT --access-logfile -
  worker:
    command:
      - celery -A celery_worker:celery worker --beat --loglevel=info --concurrency 2
    image: web